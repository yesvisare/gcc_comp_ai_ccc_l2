L3 M2: Security_Access_Control - Example Text Data

===== EXAMPLE OAUTH FLOWS =====

Example 1: Successful OAuth Login
User clicks "Login with Okta" → Redirect to https://dev-12345.okta.com/oauth2/v1/authorize
User authenticates with username/password + MFA
IdP redirects back with authorization code
System exchanges code for tokens
Access token issued: eyJhbGciOiJSUzI1NiIsIn... (truncated)
User session created with tenant_abc isolation

Example 2: Token Validation Request
Incoming request with Bearer token
JWT signature verified: VALID
Token claims: sub=user_12345, tenant_id=tenant_abc, roles=["Developer"]
Expiration check: Token valid until 2024-11-16T11:00:00Z
RBAC check: Developer has 'write' permission
Tenant isolation: tenant_abc == tenant_abc (PASS)
Request authorized

Example 3: Session Hijacking Detection
Original session: IP=192.168.1.100, User-Agent=Mozilla/5.0
New request: IP=10.0.0.50, User-Agent=Mozilla/5.0
IP MISMATCH DETECTED: 192.168.1.100 != 10.0.0.50
Session hijacking suspected
Request rejected with 401 Unauthorized

===== EXAMPLE TENANT ISOLATION SCENARIOS =====

Scenario 1: Same-Tenant Access (ALLOWED)
User tenant_id: tenant_abc
Document tenant_id: tenant_abc
Validation: PASS - access granted

Scenario 2: Cross-Tenant Access (DENIED)
User tenant_id: tenant_abc
Document tenant_id: tenant_xyz
Validation: FAIL - cross-tenant access denied
Error: ValueError("Cross-tenant access denied")

===== EXAMPLE RBAC PERMISSION CHECKS =====

Check 1: Admin deleting documents
User roles: ["Admin"]
Required permission: "delete"
Result: GRANTED (Admin has all permissions)

Check 2: Viewer attempting write
User roles: ["Viewer"]
Required permission: "write"
Result: DENIED (Viewer only has 'read')

Check 3: Developer executing code
User roles: ["Developer"]
Required permission: "execute"
Result: GRANTED (Developer has read, write, execute)

Check 4: Analyst managing users
User roles: ["Analyst"]
Required permission: "manage_users"
Result: DENIED (Only Admin can manage users)

===== EXAMPLE SESSION LIFECYCLE =====

Session Creation:
- User ID: user_12345
- Session ID: session_abc123def456
- IP Address: 192.168.1.100
- User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)
- Created: 2024-11-16T10:00:00Z
- Expires: 2024-11-16T11:00:00Z (1 hour TTL)

Session Validation (15 minutes later):
- Session ID: session_abc123def456
- Current IP: 192.168.1.100 (MATCH)
- Current User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) (MATCH)
- Last Activity: 2024-11-16T10:15:00Z
- Status: VALID

Session Expiration:
- Current Time: 2024-11-16T11:05:00Z
- Session Expires: 2024-11-16T11:00:00Z
- Status: EXPIRED (automatically deleted by Redis TTL)

===== EXAMPLE PKCE FLOW =====

Step 1: Generate PKCE Pair
code_verifier: dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk (random 128-char string)
code_challenge: E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM (SHA256 hash, base64url-encoded)

Step 2: Authorization Request
Redirect to: https://idp.okta.com/oauth2/v1/authorize?client_id=abc123&redirect_uri=http://localhost:8000/auth/callback&response_type=code&code_challenge=E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM&code_challenge_method=S256&state=random_state&scope=openid%20profile%20email

Step 3: Token Exchange
POST to https://idp.okta.com/oauth2/v1/token
Body: grant_type=authorization_code&code=auth_code_from_idp&redirect_uri=http://localhost:8000/auth/callback&code_verifier=dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk&client_id=abc123&client_secret=secret123

Step 4: Receive Tokens
{
  "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",
  "id_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "v1.MRrty1p7DRz4DRz...",
  "expires_in": 3600,
  "token_type": "Bearer"
}

===== EXAMPLE FAILURE SCENARIOS =====

Failure 1: Authorization Code Replay
First request: Exchange code abc123 → SUCCESS (tokens issued)
Second request: Exchange code abc123 → ERROR: "Authorization code already used"

Failure 2: Mismatched redirect_uri
Configured: http://localhost:8000/auth/callback
Request: http://localhost:8000/auth/callback/ (trailing slash)
Result: ERROR: "redirect_uri mismatch"

Failure 3: Expired Token
Token issued: 2024-11-16T10:00:00Z
Token expires: 2024-11-16T11:00:00Z
Current time: 2024-11-16T11:30:00Z
Validation: ERROR: "Token has expired" (ExpiredSignatureError)

Failure 4: Invalid Signature
Token payload modified: Changed tenant_id from tenant_abc to tenant_xyz
Signature verification: FAILED
Result: ERROR: "Invalid signature" (reject request, force re-authentication)

Failure 5: Cross-Tenant Document Access
User: john.doe@example.com (tenant_abc)
Document: sensitive_report.pdf (tenant_xyz)
Validation: FAILED - cross-tenant access denied
HTTP Status: 403 Forbidden

===== EXAMPLE MFA ENFORCEMENT =====

MFA Required for Admin Role:
User: jane.smith@example.com
Roles: ["Admin"]
MFA Status: Enabled (TOTP via Google Authenticator)
Login Flow: Password → TOTP Code (123456) → Access Granted

MFA Not Required for Viewer Role:
User: alice.viewer@example.com
Roles: ["Viewer"]
MFA Status: Not Enabled
Login Flow: Password → Access Granted

===== EXAMPLE AUDIT LOG ENTRIES =====

[2024-11-16 10:00:00] INFO - User john.doe@example.com (tenant_abc) logged in from IP 192.168.1.100
[2024-11-16 10:05:12] INFO - User john.doe@example.com accessed document doc_456 (tenant_abc)
[2024-11-16 10:10:45] WARNING - User bob.analyst@example.com (tenant_xyz) attempted to access document doc_456 (tenant_abc) - DENIED (cross-tenant)
[2024-11-16 10:15:20] ERROR - Session hijacking detected for user john.doe@example.com - IP changed from 192.168.1.100 to 10.0.0.50
[2024-11-16 10:20:00] INFO - User john.doe@example.com logged out - session session_abc123 revoked
[2024-11-16 10:30:15] CRITICAL - MFA BYPASS granted for user emergency_admin@example.com by admin@example.com (reason: System maintenance)

===== END OF EXAMPLES =====
